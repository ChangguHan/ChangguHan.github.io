---
title:  "HTTPS에 대하여"

categories:
  - Blog
tags:
  - Blog
---
### NHN 베이스캠프 기초 교육 정리
- 주제 : HTTP/HTTPS
- 교육일자 : 2021.02.08 
- 발표자 : NHN 김정훈 선임
- 주최 : NHN 베이스캠프 운영팀

### HTTP
- HTTP : 텍스트 기반으로 인터넷에서 데이터 주고받을 수 있는 규약
- protocol layers에서 HTTP 메시지 구성
    - 네트워크 엑세스 : 이더넷 헤더, 이더넷 페이로드
    - 인터넷게층 : 이더넷 페이로드 = IP 헤더 + IP 페이로드
    - 전송계층 : IP 페이로드 = TCP 헤더 + TCP 페이로드
    - 응용계층 : TCP 페이로드 = HTTP 헤더 + HTTP 페이로드
- HTTP 버전
    - 초기버전 0.9 : 1.0이 나오면서 이전버전과 구분짓기 위해 사용
    - 1.0 : 하나의 연결을 통해 한번 요청을 보냄
    - 1.1 : 표준 프로토콜, 헤더에 다양한 웹브라우저가 만든 것들을 붙이기 시작해서, 표준을 정하기 위해 사용
        - 파이플라인 기법을 사용해 한번 연결 후 여러번 요청이 가능
        - 단 패킷이 유실되거나, 서버에서의 처리가 느릴경우 병목현상 발생(HOLB)
    - 2 : TCP/IP가 한번 통신하는데 드는 비용이 커서 이것을 줄이기 위해서 사용
    - 3 : 모바일환경을 위해서 만든 QUIC 프로토콜 사용
- HTTP 특징
    - connectionless : 응답 마치면 연결 끊음
        - 인터넷 속도가 빠르기 전에 HTTP보다 TCP/IP 서비스가 훨씬 많았음
        - TCP/IP는 커넥션 맺어놓고 필요한 데이터를 지속해서 주고 받음 >> 서버에서 클라이언트로 요청없이 보내주는 것도 가능했음
    - stateless : 서버가 클라이언트이 정보를 가지지 않음
        - TCP/IP : 커넥션과 매칭해서 사용자가 로그인한 정보들을 서버에서 관리
    - 사용자 정보 저장하지 않으면?
        - 아이디정보 저장, 비로그인 상태에서 장바구니관리 어떻게? > 이것을 해결하는 것이 쿠키
        - 쿠키 : 서버에서 사용자 정보를 관리하지 않는 것을, 클라이언트에서 매번 요청할때마다 요청정보를 던져줌
- HTTP 메시지 헤더
    - 일반헤더 : 요청, 응답 모두에 적용되는 헤더, 바디 데이터에 관련된 헤더는 제외
        - 날짜, 연결, 캐시 컨트롤
    - 요청헤더 : 요청하는데에만 필요, 요청 정보에 부가적인 정보, 클라이언트에 관련된 헤더
        - 호스트 : 요청하는 서버의 정보
        - User-Agent : 요청하는 브라우저의 정보
        - Referer : 서버 도착하기 전 어디에서 머물렀느닞
    - 응답헤더 : 서버에 관련된 정보
        - 서버 : 서버정보
        - 로케이션 : Redirection과 연관, 특정 페이지로 이동시킬때 로케이션 헤더 이용해서 주소 적어주면 이동함
        - Age
        - 셋쿠키
    - 엔티티 헤더 : 바디와 관련된 헤더, 바디에 어떤 데이터, 어떤 타입으로 오는지
        - Content-Type : REST API : json, HTML : text
    - 사용자 정의 헤더
        - RFD 6648에선 폐기되었는데 아직 많이 쓰임
        - 웹서버에서 클라이언트 정보 획득할때
        - 원래 로드밸런서 통하기때문에 바로 클라이언트 아이피 얻을 수 없음
        - 근데  X-FORWARDED 사용하면 클라이언트 IP 정보 얻을 수 있음
        - 근데 악의적으로 사용하려면 할 수 있어서, 신뢰성에 대해 고민해봐야함
### 쿠키
- 서버가 브라우저에 전송하는 데이터
- 브라우저는 데이터 조각 저장해서, 다음 요청시 전송 및 방문자 상태 저장
- 보냄 : 브라우저 -> 서버
    - 유저ID, PW : 접속을해서 이미 쿠키가 만들어져있음
- 받음 : 브라우저 <- 서버
    - 입력창에서 아이디와 패스워드 입력
- 개발자도구 Application - Coolies
    - 쿠키정보 저장
    - 아이디 패스워드 로그인하면
    - 쿠키에 저장
- IE는 쿠키파일을 사용자가 볼수 있는 파일로 기록
- 크롬은 특정 데이터베이스 파일로 기록
- 목적
    - 장바구니
    - 트래킹 : 광고서버에 트래킹 아이디 심는 예제
        - 연관된 광고가 계속 노출
        - 1. 네이버 접속
        - 2. 열혈강호 배너 노출 시, 광고회사 노출 태그 호출
        - 3. 광고회사 응답 받아 사용자 PC에 UUID저장(쿠키값 이용)
        - 4. 열혈강호 배너 클릭
        - 5. 열혈강호 홈페이지 접속
        - 6. 열혈강호 메인 페이지에서 광고회사 트랙 태그 호출(쿠키값 이용)
        - 광고회사 : UUID를 이용해 사용자 이동경로 추적
        - 도메인 기준으로 하위 도메인에는 쿠키가 다같이 전송
- 쿠키 종류
    - 지속 쿠키, Persistent Cookie
        - 유지가되는 쿠키
        - 로컬 파일 디렉토리에 파일로 저장
        - 브라우저에서 특정 페이지 요청시, setCookie되어 쿠키가 저장됨, 그다음 쿠키에 담아서 보냄
    - 세션 쿠키, Session Cookie
        - 브라우저 종료 시, 해당 정보 삭제
        - 브라우저가 구동중일때만 저장되는 쿠키
    - 둘을 어떻게 구분?
        - 응답에서 Set-Cookie : Expire, Max-Age가 하나라도 있으면 지속쿠키
        - 둘다 없으면 세션쿠키
- 위험성 : 로그인 관련 정보를 쿠키에만 넣으면 클라이언트에서 쿠키정보 위조할 가능성 있음
    - 비밀번호와 같은 중요정보는 저장하면 안됨
        - 저장하더라도 암호화해서 저장
    - 한게임은 사용자마다 고유한 멤버 넘버를 가짐, 멤버넘버를 암호화해서 세션 쿠키에 저장
    - 삭제하는 url에서 쿠키에 저장된 아이디들을 가지고 악의적으로 사용할 수 있음
- 세션 쿠키 활용
    - 보안을 위해서 세션 쿠키를 더 많이 활용
    - 쿠키정보를 서버에 저장
    - 로그인 하는 시점에, 세션쿠키를 발급해서 아이디 패스워드 정보를 디비나 로컬에 저장
    - 로그인 시도하면, 아이디패스워드 웹서버에 전달되어, 유니크 아이디를 조합해서 다른사람들이 아이디를 가지고 사용자 정보를 추측하지 못하도록 스토리지에 저장
    - 브라우저에 세션 아이디를 저장하라고 전달
    - 요청보낼때 세션아이디 보내면, 웹서버는 조회하고 작업 처리
    - 로그아웃 : 기존 저장된 정보들을 삭제

### HTTPS
- 빨간글씨로 연결이 비공개로 설정되어있습니다
    - ERR_CERT_AUTHORITY_INVALID
    - 인증서가 인증기관에서 신뢰받은 것이 아닌 경우에 발생
    - HTTPS인척하는 페이지
    - 사설인증서 사용할 경우 이렇게됨
    - HTTPS 통신이 가능하게끔만 만들었는데,
- HTTPS 사용할 경우 : 교환되는 모든 실제 데이터는 암호화됨
    - 요청 URL, 웹사이트 내용, 검색어 매개변수, 헤더, 쿠키
    - 통신이 끝난 상태에서는 브라우저에서는 확인 가능
    - 중간에 패킷이 해킹당했을때 정보가 노출되지 않음
    - 이걸 확인하려면 fiddler라는 앱을 사용하면 됨
    - 피들러라는 앱이 특정 랜카드를 통해 통신하는 모든 것들을 캡처해서 보여줌, 실제로 암호화해서 가는건가를 보여줌
- SSL vs TLS
    - SSL암호화는 흔히 TLS
    - TLS : IETF에서 표준화, 최신버전 1.3은 지원하는 브라우저가 많지가 않음,
- SSL 동작과정
    - 브라우저가 요청할떄, SSL 버전이 모두 다름, 이런 암호화 알고리즘 사용이 가능하다고 먼저 전달
    - 그럼 서버에서 이런 인증서를 쓰고 있어라고 전달
    - 브라우저 : 인증서 신뢰여부 파악 >> 빨간색 혹은 녹색으로 표시
- 핸드쉐이크
    - 브라우저가 이런이런 알고리즘 사용 가능해, 그럼 서버는 이걸로하자
    - 대칭키를 전달하고 인증서 전달하는 과정
- 비대칭키 알고리즘
    - RSA 방식으로 암호화 한것
    - 암호화 한 키와 복호화 한 키가 다름
    - 단점 : 암복호화 속도가 매우 느림
    - 그럼에도 사용하는 이유 >> 암복호화 속도가 느리기 위해, 중요한 정보를 전달하기에만 쓰임, 나머지는 대칭키를 사용
- 보안등급확인 : https://www.ssllabs.com
  
### Q&A
- SSL을 사용할때 인증서와 암호화는 별개의 과정으로 보이는데 일부만 선택해서 사용할 수도 있나?
    - 브라우저에서 특정 조건의 전달이 되었을때 선택할수 있는 부분이 있어야하는데
    - 웹개발자의 영역이 아닌 브라우저의 영역인것 같아서 불가능할 것 같음
- 인증서를 요청할때 다른 서버가 다른 인증서를 보내는건 불가능?
    - 웹서버가 구동할때 특정 인증서를 지정
    - 해당 도메인이 아니면 인증서를 보내면 오류가 나옴
- HTTPS 인증서 발급 방법
    - 개인이 인증서 발급하려면 >> 대행사가 굉장히 많음
    - 예시 : certkorea.co.kr
    - 서브도메인으로 여러가지 api.rookie, web.rookie 이런식으로 사용할경우, 인증서를 발급해서 이메일로 전달
- 무료로 인증서 배포해주는 사이트 있음에도 돈을 내고 사용하는 이유는?
    - 주기가 짧고, 언제 없어질지 모름
    - 인증기관에 돈을 내면 해커에 대한 공격에 대한 피해를 보상해줌
    - 근데 개인으로 사용하면, 별도의 보상이 없음
- HTTP 헤더의 host 정보가 TCP와 IP헤더에 이미 들어있는정보인데 왜 또들어가는지?
    - 개발할때 TCP/IP 계층까지 들어가서 정보를 가져오진 않음
- 사설 인증서를 설치했는데, 윈도우 환경에서는 제대로 작동, 맥에서는 동일한 브라우저인데도 작동을 안하는게 왜 그럴까
    - 서버는 뜨는데 안전하지 않은 사이트라고 뜸
    - 퍼미션 조정을 해보는것이 하나의 방법이 될것 같음

